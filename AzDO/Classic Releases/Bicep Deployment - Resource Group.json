{"tasks":[{"environment":{},"displayName":"Azure CLI ","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"connectedServiceNameARM":"$(subscription)","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"  templatefile='$(TemplateFile)'\n  templateparameterfile='@$(TemplateParameterFile)'\n  params=\"\"\n  if [ \"$(ParameterOverrides)\" != \"\" ]; then \n   echo \"adding parameter overrides\"\n   params+=\" --parameters $(ParameterOverrides)\"\n  fi\n  if [ $templateparameterfile != \"\" ]; then \n   echo \"adding template file\"\n   params+=\" --parameters '${templateparameterfile//\\\\//}'\"\n  fi\n  \n  args=\"--name deploy --resource-group $(resourceGroupName) --template-file ${templatefile//\\\\//}\"\n  \n  \n  echo $args\n  echo $params\n  az deployment group create $args $params\n  \n  echo \"az deployment group show --resource-group '$(resourceGroupName)' --name deploy\"\n  deploymentoutputs=$(az deployment group show --resource-group '$(resourceGroupName)' --name deploy \\\n\t--query properties.outputs)\n  echo 'convert outputs to variables'\n  echo $deploymentoutputs | jq -c '. | to_entries[] | [.key, .value.value, .value.type]' |\n\twhile IFS=$\"\\n\" read -r c; do\n\t  keyname=$(echo \"$c\" | jq -r '.[0]')\n\t  value=$(echo \"$c\" | jq -r '.[1]')\n\t  type=$(echo \"$c\" | jq -r '.[2]')\n\t  \n\t  if [ \"$type\" == \"SecureString\" ]; then\n\t\techo \"##vso[task.setvariable variable=$keyname;issecret=true]$value\"\n\t\techo \"Added variable '$keyname' ('$type')\"\n\t  elif [ \"$type\" == \"String\" ]; then \n\t\techo \"##vso[task.setvariable variable=$keyname]$value\"\n\t\techo \"Added variable '$keyname' ('$type') with value '$value'\"\n\t  else \n\t   echo \"Skipped output variable conversion: Type '$type' is not supported for '$keyname'\"\n\t  fi\n\t  \n\tdone","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"},"task":{"id":"46e4be58-730b-4389-8a2f-ea10b3e5e815","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":3,"createdBy":{"displayName":"Arno Peters","id":"6b7b6d39-61fa-4959-bf89-b8d308844343","uniqueName":"arnop@4dotnet.nl"},"createdOn":"2022-01-14T15:02:46.187Z","modifiedBy":{"displayName":"Arno Peters","id":"6b7b6d39-61fa-4959-bf89-b8d308844343","uniqueName":"arnop@4dotnet.nl"},"modifiedOn":"2022-11-11T12:47:50.517Z","comment":"","id":"65ea90a9-84f9-412d-954d-8b03f5f01ffc","name":"Bicep Deployment - Resource Group","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M197_20220105.3/_content/icon-meta-task.png","friendlyName":"Bicep Deployment - Resource Group","description":"Wrapper around Azure CLI to simplify deploying a Bicep template to a recourse group. ","category":"Deploy","definitionType":"metaTask","author":"Arno Peters","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"ParameterOverrides","label":"ParameterOverrides","defaultValue":"deploymentContainerUri='$(deploymentBlobContainerUri)$(Build.SourceBranchName)/$(Build.BuildNumber)' deploymentContainerSasToken='$(deploymentBlobContainerSasToken)' environment='$(environment)' ownerTeam='$(ownerTeam)'","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"resourceGroupName","label":"resourceGroupName","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{"EndpointFilterRule":""},"name":"subscription","label":"subscription","defaultValue":"$(subscription)","required":true,"type":"connectedService:AzureRM","helpMarkDown":"Select an Azure Resource Manager service connection for the deployment","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"TemplateFile","label":"TemplateFile","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"TemplateParameterFile","label":"TemplateParameterFile","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Bicep Deployment - Resource Group $(ParameterOverrides)","preJobExecution":{},"execution":{},"postJobExecution":{}}